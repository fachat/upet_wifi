
	.(

SPIBASE		=$e808

SPI_CTRL	=SPIBASE + 0
SPI_DATA	=SPIBASE + 1
SPI_PEEK	=SPIBASE + 2	

&spisel	
	ldx #4		; device 4 = network port, SPI mode 0
	.byt $2c
&spidesel
	ldx #<-1
:	bit SPI_CTRL
	bmi :-
	stx SPI_CTRL
	rts

&spipeek
	lda SPI_PEEK
	rts

&spitx
	bit SPI_CTRL
	bvs spitx
	sta SPI_DATA
	rts

&spirx
	lda #$ff
&spirxtx
	bit SPI_CTRL
	bvs spirxtx
	sta SPI_DATA
:	bit SPI_CTRL
	bmi :-
	lda SPI_PEEK
	rts
	.)

